<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>バウンティラッシュかけら計算</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f8ff;
            color: #333;
        }
        h1 {
            color: #4169e1;
            text-align: center;
        }
        input, select, button {
            margin-bottom: 10px;
            width: 100%;
            padding: 8px;
            border: 1px solid #4169e1;
            border-radius: 4px;
        }
        button {
            background-color: #4169e1;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #1e90ff;
        }
        #result {
            margin-top: 20px;
            font-weight: bold;
            text-align: center;
            color: #4169e1;
            font-size: 1.2em;
            background-color: #e6f2ff;
            padding: 15px;
            border-radius: 4px;
        }
        #historyContainer {
            display: none;
            margin-top: 20px;
            background-color: #e6f2ff;
            padding: 10px;
            border-radius: 4px;
        }
        .history-entry {
            padding: 10px;
            background-color: white;
            border: 1px solid #ccc;
            margin-bottom: 5px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .delete-btn {
            background-color: red;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
        }
        .delete-btn:hover {
            background-color: darkred;
        }
        #notice {
            background-color: #e6f2ff;
            padding: 10px;
            border-radius: 4px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>バウンティラッシュかけら計算</h1>

    <label for="characterName">キャラクター名（任意）：</label>
    <input type="text" id="characterName" placeholder="キャラ名を入力"><br>

    <label for="startDate">開始日：</label>
    <input type="date" id="startDate"><br>

    <label for="targetShards">目標かけら数：</label>
    <input type="number" id="targetShards" min="1"><br>

    <label for="characterType">キャラクターの種類：</label>
    <select id="characterType">
        <option value="ultra">超フェス</option>
        <option value="limited">フェス限</option>
        <option value="regular">恒常</option>
    </select><br>

    <div id="limitedOptions" style="display:none;">
        <label for="purchaseRush">得ラッシュ30を購入しますか？</label>
        <select id="purchaseRush">
            <option value="yes">はい</option>
            <option value="no">いいえ</option>
        </select><br>
    </div>

    <button onclick="calculateDate()">計算する</button>

    <div id="result"></div>

    <button onclick="toggleHistory()">履歴を見る</button>

    <div id="historyContainer">
        <h3>計算履歴</h3>
        <div id="historyList"></div>
    </div>

    <div id="notice">
        <h3>注意事項：</h3>
        <ul>
            <li>恒常の場合、毎日交換所で10個交換するとします。</li>
            <li>得ラッシュを購入する場合は、キャラのかけら5個＋星4かけら1個の計6個とします。</li>
            <li>ログイン報酬や配布でもらえるかけらは含まれていないので、表示されたものより早く目標数に達成することがあります。</li>
        </ul>
    </div>

    <script>
        function showHideOptions() {
            document.getElementById('limitedOptions').style.display = 
                document.getElementById('characterType').value === 'limited' ? 'block' : 'none';
        }

        document.getElementById('characterType').addEventListener('change', showHideOptions);

        function calculateDate() {
            const characterName = document.getElementById('characterName').value.trim();
            const startDate = new Date(document.getElementById('startDate').value);
            const targetShards = parseInt(document.getElementById('targetShards').value);
            const characterType = document.getElementById('characterType').value;
            const purchaseRush = document.getElementById('purchaseRush').value;

            if (!targetShards || targetShards <= 0) {
                document.getElementById('result').innerHTML = '<span style="color: red; font-weight: bold;">目標かけら数を正しく入力してください。</span>';
                return;
            }

            let dailyShards = 0;
            if (characterType === 'regular') {
                dailyShards += 10;
            } else if (characterType === 'limited' && purchaseRush === 'yes') {
                dailyShards += 6;
            }

            let totalDays = 0;
            let currentShards = 0;
            while (currentShards < targetShards) {
                currentShards += dailyShards;
                totalDays++;
            }

            const targetDate = new Date(startDate.getTime() + totalDays * 24 * 60 * 60 * 1000);
            let resultText = `目標達成予定日: ${targetDate.toLocaleDateString('ja-JP')}`;
            if (characterName) {
                resultText = `キャラ: ${characterName} ${resultText}`;
            }
            document.getElementById('result').innerText = resultText;

            saveHistory(characterName || "未入力", targetDate.toLocaleDateString('ja-JP'));
        }

        function saveHistory(characterName, targetDate) {
            const historyList = document.getElementById('historyList');
            const entry = document.createElement('div');
            entry.className = 'history-entry';
            entry.innerHTML = `
                <span>${characterName}: ${targetDate}</span>
                <button class="delete-btn" onclick="deleteHistory(this)">削除</button>
            `;
            historyList.appendChild(entry);
        }

        function deleteHistory(button) {
            button.parentElement.remove();
        }

        function toggleHistory() {
            const historyContainer = document.getElementById('historyContainer');
            historyContainer.style.display = historyContainer.style.display === 'none' ? 'block' : 'none';
        }

        document.getElementById('startDate').valueAsDate = new Date();
        showHideOptions();
    </script>
</body>
</html>
