<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ©ãƒƒã‚·ãƒ¥ã‹ã‘ã‚‰è¨ˆç®—</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f0f8ff;
      color: #333;
    }
    /* å„ãƒ•ã‚©ãƒ¼ãƒ é …ç›®ã‚’ã‚³ãƒ³ãƒ†ãƒŠã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ– */
    .form-group {
      margin-bottom: 15px;
    }
    /* ãƒ©ãƒ™ãƒ«ã‚’ãƒ–ãƒ­ãƒƒã‚¯è¡¨ç¤ºã«ã—ã¦ä½™ç™½ã‚’è¿½åŠ  */
    label {
      display: block;
      margin-bottom: 5px;
    }
    /* å…¥åŠ›æ¬„ãƒ»ã‚»ãƒ¬ã‚¯ãƒˆãƒ»ãƒœã‚¿ãƒ³ã¯æ¨ªå¹…100%ã§è¡¨ç¤º */
    input, select, button {
      width: 100%;
      padding: 8px;
      border: 1px solid #4169e1;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background-color: #4169e1;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #1e90ff;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
      text-align: center;
      color: #4169e1;
      font-size: 1.2em;
      background-color: #e6f2ff;
      padding: 15px;
      border-radius: 4px;
    }
    #notice, #historyContainer {
      background-color: #e6f2ff;
      padding: 10px;
      border-radius: 4px;
      margin-top: 20px;
    }
    .error {
      color: red;
      font-weight: bold;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      padding: 5px;
      border-bottom: 1px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .delete-btn {
      background-color: red;
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      cursor: pointer;
      font-size: 16px;
      line-height: 24px;
      text-align: center;
      padding: 0;
      border-radius: 3px;
    }
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
        line-height: 1.2;
      }
    }
  </style>
</head>
<body>
  <h1>ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ©ãƒƒã‚·ãƒ¥ã‹ã‘ã‚‰è¨ˆç®—</h1>

  <div class="form-group">
    <label for="characterName">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å (ä»»æ„)ï¼š</label>
    <input type="text" id="characterName" placeholder="">
  </div>

  <div class="form-group">
    <label for="startDate">é–‹å§‹æ—¥ï¼š</label>
    <input type="date" id="startDate">
  </div>

  <div class="form-group">
    <label for="targetShards">ç›®æ¨™ã‹ã‘ã‚‰æ•°ï¼š</label>
    <input type="number" id="targetShards" min="1">
  </div>

  <div class="form-group">
    <label for="characterType">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç¨®é¡ï¼š</label>
    <select id="characterType">
      <option value="ultra">è¶…ãƒ•ã‚§ã‚¹</option>
      <option value="limited">ãƒ•ã‚§ã‚¹é™</option>
      <option value="regular">æ’å¸¸</option>
    </select>
  </div>

  <div class="form-group" id="limitedOptions" style="display:none;">
    <label for="purchaseRush">å¾—ãƒ©ãƒƒã‚·ãƒ¥30ã‚’è³¼å…¥ã—ã¾ã™ã‹ï¼Ÿ</label>
    <select id="purchaseRush">
      <option value="yes">ã¯ã„</option>
      <option value="no">ã„ã„ãˆ</option>
    </select>
  </div>

  <div class="form-group">
    <label for="specialTraining">ç‰¹è¨“ã‚’ã—ã¾ã™ã‹ï¼Ÿ</label>
    <select id="specialTraining">
      <option value="yes">ã¯ã„</option>
      <option value="no">ã„ã„ãˆ</option>
    </select>
  </div>

  <!-- ç‰¹è¨“é–¢é€£ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯2ã¤ã«åˆ†ã‘ã¦ã„ã¾ã™ -->
  <div class="form-group" id="trainingOptions" style="display:none;">
    <label for="allianceCheer">åŒç›Ÿã‚¨ãƒ¼ãƒ«ãŒä½¿ãˆã¾ã™ã‹ï¼Ÿ</label>
    <select id="allianceCheer">
      <option value="yes">ã¯ã„</option>
      <option value="no">ã„ã„ãˆ</option>
    </select>
  </div>

  <div class="form-group" id="trainingPaid" style="display:none;">
    <label for="paidTraining">ç‰¹è¨“ã«èª²é‡‘ã—ã¾ã™ã‹ï¼Ÿ</label>
    <select id="paidTraining">
      <option value="yes">ã¯ã„</option>
      <option value="no">ã„ã„ãˆ</option>
    </select>
  </div>

  <div class="form-group">
    <label for="leagueRewards">ãƒªãƒ¼ã‚°å ±é…¬ã®ã‹ã‘ã‚‰ã‚’ä½¿ã„ã¾ã™ã‹ï¼Ÿ</label>
    <select id="leagueRewards">
      <option value="yes">ã¯ã„</option>
      <option value="no">ã„ã„ãˆ</option>
    </select>
  </div>

  <div class="form-group" id="leagueOptions" style="display:none;">
    <label for="leagueRank">ã‚·ãƒ¼ã‚ºãƒ³æœ€çµ‚æ—¥ã®ãƒ©ãƒ³ã‚¯ï¼š</label>
    <select id="leagueRank">
      <option value="SS">SS</option>
      <option value="S+">S+</option>
      <option value="S">S</option>
      <option value="S-">S-</option>
      <option value="A+">A+</option>
      <option value="A">A</option>
      <option value="A-">A-</option>
    </select>
  </div>

  <div class="form-group">
    <label for="challengeBattle">ãƒãƒ£ãƒ¬ãƒãƒˆã§ã‚‚ã‚‰ãˆã‚‹ã‹ã‘ã‚‰ã‚’ä½¿ã„ã¾ã™ã‹ï¼Ÿ</label>
    <select id="challengeBattle">
      <option value="yes">ã¯ã„</option>
      <option value="no">ã„ã„ãˆ</option>
    </select>
  </div>

  <div class="form-group" id="challengeOptions" style="display:none;">
    <label for="paidChallenge">ãƒãƒ£ãƒ¬ãƒãƒˆã«èª²é‡‘ã—ã¾ã™ã‹ï¼Ÿ</label>
    <select id="paidChallenge">
      <option value="yes">ã¯ã„</option>
      <option value="no">ã„ã„ãˆ</option>
    </select>
  </div>

  <div class="form-group">
    <button onclick="calculateDate()">è¨ˆç®—ã™ã‚‹</button>
  </div>

  <div id="result"></div>

  <div id="notice">
    <h3>æ³¨æ„äº‹é …ï¼š</h3>
    <ul>
      <li>æ’å¸¸ã®å ´åˆã€æ¯æ—¥äº¤æ›æ‰€ã§10å€‹äº¤æ›ã™ã‚‹ã¨ã—ã¾ã™ã€‚</li>
      <li>å¾—ãƒ©ãƒƒã‚·ãƒ¥ã‚’è³¼å…¥ã™ã‚‹å ´åˆã¯ã€ã‚­ãƒ£ãƒ©ã®ã‹ã‘ã‚‰5å€‹ï¼‹æ˜Ÿ4ã‹ã‘ã‚‰1å€‹ã®è¨ˆ6å€‹ã¨ã—ã¾ã™ã€‚</li>
      <li>ãƒãƒ£ãƒ¬ãƒãƒˆã®å¤‰ã‚ã‚‹å‘¨æœŸã¯1é€±é–“ã¨ä»®å®šã—ã¾ã™ã€‚</li>
      <li>ãƒ­ã‚°ã‚¤ãƒ³å ±é…¬ã‚„é…å¸ƒã§ã‚‚ã‚‰ãˆã‚‹ã‹ã‘ã‚‰ã¯å«ã¾ã‚Œã¦ã„ãªã„ã®ã§ã€è¡¨ç¤ºã•ã‚ŒãŸã‚‚ã®ã‚ˆã‚Šæ—©ãç›®æ¨™æ•°ã«é”æˆã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚</li>
    </ul>
  </div>

  <div id="historyContainer">
    <h3>è¨ˆç®—å±¥æ­´</h3>
    <ul id="historyList"></ul>
  </div>

  <script>
    // ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºï¼éè¡¨ç¤º
    function showHideOptions() {
      document.getElementById('limitedOptions').style.display =
        document.getElementById('characterType').value === 'limited' ? 'block' : 'none';
      if (document.getElementById('specialTraining').value === 'yes') {
        document.getElementById('trainingOptions').style.display = 'block';
        document.getElementById('trainingPaid').style.display = 'block';
      } else {
        document.getElementById('trainingOptions').style.display = 'none';
        document.getElementById('trainingPaid').style.display = 'none';
      }
      document.getElementById('leagueOptions').style.display =
        document.getElementById('leagueRewards').value === 'yes' ? 'block' : 'none';
      document.getElementById('challengeOptions').style.display =
        document.getElementById('challengeBattle').value === 'yes' ? 'block' : 'none';
    }
    document.getElementById('characterType').addEventListener('change', showHideOptions);
    document.getElementById('specialTraining').addEventListener('change', showHideOptions);
    document.getElementById('leagueRewards').addEventListener('change', showHideOptions);
    document.getElementById('challengeBattle').addEventListener('change', showHideOptions);

    // å±¥æ­´è¡¨ç¤ºå‡¦ç†
    function updateHistoryUI() {
      const historyList = document.getElementById('historyList');
      historyList.innerHTML = '';
      const history = JSON.parse(localStorage.getItem('calculationHistory')) || [];
      for (let i = history.length - 1; i >= 0; i--) {
        const entry = history[i];
        const li = document.createElement('li');
        li.setAttribute('data-index', i);
        const nameDisplay = entry.characterName ? `<strong>${entry.characterName}</strong>ï¼š` : '';
        li.innerHTML = `${nameDisplay}ç›®æ¨™é”æˆäºˆå®šæ—¥ <em>${entry.targetDate}</em> ï¼ˆè¨ˆç®—æ—¥æ™‚ï¼š${new Date(entry.calculatedDate).toLocaleString('ja-JP')}ï¼‰`;
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.title = 'ã“ã®å±¥æ­´ã‚’å‰Šé™¤';
        deleteBtn.innerText = 'ğŸ—‘ï¸';
        deleteBtn.onclick = function() {
          deleteHistoryItem(i);
        };
        li.appendChild(deleteBtn);
        historyList.appendChild(li);
      }
    }

    // å±¥æ­´ã®é …ç›®å‰Šé™¤
    function deleteHistoryItem(index) {
      let history = JSON.parse(localStorage.getItem('calculationHistory')) || [];
      history.splice(index, 1);
      localStorage.setItem('calculationHistory', JSON.stringify(history));
      updateHistoryUI();
    }

    // è¨ˆç®—å‡¦ç†
    function calculateDate() {
      const startDateInput = document.getElementById('startDate').value;
      if (!startDateInput) {
        document.getElementById('result').innerHTML = '<span class="error">é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</span>';
        return;
      }
      const startDate = new Date(startDateInput);
      const targetShardsInput = document.getElementById('targetShards').value;
      const characterType = document.getElementById('characterType').value;
      const purchaseRush = document.getElementById('purchaseRush').value;
      const specialTraining = document.getElementById('specialTraining').value;
      const allianceCheer = document.getElementById('allianceCheer').value;
      const paidTraining = document.getElementById('paidTraining').value;
      const leagueRewards = document.getElementById('leagueRewards').value;
      const leagueRank = document.getElementById('leagueRank').value;
      const challengeBattle = document.getElementById('challengeBattle').value;
      const paidChallenge = document.getElementById('paidChallenge').value;

      if (!/^\d+$/.test(targetShardsInput)) {
        document.getElementById('result').innerHTML = '<span class="error">åŠè§’æ•°å­—ã§ç›®æ¨™ã‹ã‘ã‚‰æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</span>';
        return;
      }
      const targetShards = parseInt(targetShardsInput);

      let dailyShards = 0;
      let hasShardSource = false;

      if (characterType === 'regular') {
        dailyShards += 10;
        hasShardSource = true;
      } else if (characterType === 'limited' && purchaseRush === 'yes') {
        dailyShards += 6;
        hasShardSource = true;
      }

      if (specialTraining === 'yes') {
        const hoursPerShard = paidTraining === 'yes' ? 3.75 : 5;
        dailyShards += 24 / hoursPerShard;
        hasShardSource = true;
        if (allianceCheer === 'yes') {
          dailyShards += 1;
        }
      }

      if (challengeBattle === 'yes') {
        dailyShards += paidChallenge === 'yes' ? 60 / 7 : 20 / 7;
        hasShardSource = true;
      }

      if (!hasShardSource && characterType !== 'regular') {
        document.getElementById('result').innerHTML = '<span class="error">ã‚¨ãƒ©ãƒ¼: ã‹ã‘ã‚‰ã‚’ç²å¾—ã™ã‚‹æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</span>';
        return;
      }

      const leagueRewardMap = {
        'SS': 50, 'S+': 40, 'S': 30, 'S-': 20, 'A+': 15, 'A': 10, 'A-': 5
      };

      let totalDays = 0;
      let currentShards = 0;
      while (currentShards < targetShards) {
        currentShards += dailyShards;
        totalDays++;
        // ãƒªãƒ¼ã‚°å ±é…¬ã¯1æ—¥ã¨16æ—¥ã«åŠ ç®—
        if (leagueRewards === 'yes') {
          const currentDate = new Date(startDate.getTime() + totalDays * 24 * 60 * 60 * 1000);
          if (currentDate.getDate() === 1 || currentDate.getDate() === 16) {
            currentShards += leagueRewardMap[leagueRank];
          }
        }
      }
      const targetDate = new Date(startDate.getTime() + totalDays * 24 * 60 * 60 * 1000);
      document.getElementById('result').innerText = `ç›®æ¨™é”æˆäºˆå®šæ—¥: ${targetDate.toLocaleDateString('ja-JP')}`;

      const characterName = document.getElementById('characterName').value.trim();
      const entry = {
        characterName: characterName,
        calculatedDate: new Date().toISOString(),
        targetDate: targetDate.toLocaleDateString('ja-JP')
      };
      const history = JSON.parse(localStorage.getItem('calculationHistory')) || [];
      history.push(entry);
      localStorage.setItem('calculationHistory', JSON.stringify(history));
      updateHistoryUI();
    }

    // åˆæœŸè¨­å®š
    document.getElementById('startDate').valueAsDate = new Date();
    showHideOptions();
    updateHistoryUI();
  </script>
</body>
</html>
